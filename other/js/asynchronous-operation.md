# 异步

不管承认与否，如果想理解js的核心和提升性能，就必须要理解异步。

## 异步：现在与未来

### 1.1 分块的程序
执行时代码是一块一块执行的。基本的块是函数块。

函数块
(宏任务,微任务)

### 1.2 事件循环
虽然可能之前已经编写了js异步代码，但es6才真正内建有直接的异步概念。

js引擎做的只不过是任务代码执行完，从任务队列取任务执行。
所有宿主环境，提供了一种机制，执行每块代码时调用js引擎，这种机制被称为事件循环。

js引擎本身并没有时间的概念，只是一个按需执行js代码片段的环境。

"事件"调度问题由包含它的宿主环境进行。

```js
// 极简伪代码
// eventLoop是一个用作队列的数组
// 先进先出
let eventLoop = []
let event
// ‘永远’执行
while (true){
  // 一次tick
  if(eventLoop.length > 0) {
    // 拿到队列中的下一个事件
    event = eventLoop.shift()

    // 现在，执行下一个事件
    try {
      event()
    }
    catch (err) {
      reportError(err)
    }
  }
}
```

### 1.3 并行线程

并行计算最常用的工具是进程和线程。进程和线程独立运行，并可能同时运行。
多个线程能够共享单个进程的内存。

需要注意的是，事件循环把任务代码分成一块一块执行，不允许对共享内存进行并行访问和修改。

并行线程的交替执行和异步事件的交替调度，它们的粒度是不一样的。

## 回调

## Promise

## 生成器
